<!doctype html><html lang="en"><head><meta name="viewport" content="initial-scale=1,user-scalable=no"/><meta http-equiv="content-type" content="text/html; charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><link rel="shortcut icon" href="/favicon.png" type="image/x-icon"/><link rel="icon" href="/favicon.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="apple-mobile-web-app-title" content="Blasthole_Dipping"/><link rel="apple-touch-icon" href="/logo192.png"/><link rel="manifest" href="/manifest.json"/><title>Blasthole Dipping</title><link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/><link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css"/><link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css"/><script src="https://kit.fontawesome.com/05c6b543c0.js" crossorigin="anonymous"></script><script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script><script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/hosuaby/Leaflet.SmoothMarkerBouncing@v2.0.0/dist/bundle.js" crossorigin="anonymous"></script><script src="https://code.jquery.com/jquery-1.10.2.js"></script><script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script><link href="/static/css/2.3661fc73.chunk.css" rel="stylesheet"><link href="/static/css/main.cf3c6533.chunk.css" rel="stylesheet"></head><body><div id="map"></div><div id="root"></div><div id="updatepanel"><input type="button" onclick="getBlastPolygons()" value="Update DB"/></div><script>let currentpos,currentPositionMarker,currentlat,currentlng,wpid=!1,markerscales=[1,2,3,4,5,6,7,8,9,10,14,18,22,25,28,32,35,38,40,42,44,46,48,50],currentposmarker=new L.LayerGroup,holemarkers=new L.LayerGroup,myposIcon=getIcon("/images/pos.png",[10,10],[5,5],[0,-15]);function getIcon(e,o,r,t){return L.icon({id:"",event_id:"",iconUrl:e,iconSize:o,iconAnchor:r,popupAnchor:t})}let map=L.map("map",{minZoom:3,maxZoom:22}).setView([-27.9245562287,122.36137027844],18);function displayAndWatch(e){setCurrentPosition(e)}function locError(e){switch(e.code){case e.PERMISSION_DENIED:break;case e.POSITION_UNAVAILABLE:case e.TIMEOUT:case e.UNKNOWN_ERROR:wpid=navigator.geolocation.getCurrentPosition(displayAndWatch,locError,{maximumAge:0,timeout:1e3,enableHighAccuracy:!0})}}function setCurrentPosition(e){currentlat=e.coords.latitude,currentlng=e.coords.longitude,currentposmarker.clearLayers(),currentPositionMarker=L.marker([e.coords.latitude,e.coords.longitude],{icon:myposIcon}).addTo(map).bindPopup("current position"),currentposmarker.addLayer(currentPositionMarker)}map.locate({setView:!0,maxZoom:16}),map.zoomControl.setPosition("bottomright"),map.on("zoomend",(function(){let e=map.getZoom();markerscales[e]})),currentposmarker.addTo(map),$(document).ready((function(){navigator.geolocation?wpid=navigator.geolocation.getCurrentPosition(displayAndWatch,locError,{maximumAge:0,timeout:1e3,enableHighAccuracy:!0}):alert("Your browser does not support the Geolocation API")}));var blastKey,geojson=[];function getblastdata1(){$.getJSON("https://www.haulsmart.com/apis/patterndata.php",(function(e){geojson=e,L.geoJson(e,{style:areaStyle,onEachFeature:onEachFeature}).addTo(map)}))}function getPolygons(){console.log("getPatterns");var e,o=getObjectStore("polygons","readwrite");try{e=o.getAll()}catch(e){console.log(e)}e.onsuccess=function(o){console.log("Reading DB successful"),console.log(e.result[0]),geojson=e.result[0],L.geoJson(geojson,{style:areaStyle,onEachFeature:onEachFeature}).addTo(map)},e.onerror=function(){console.error("read db error",this.error)}}function onEachFeature(e,o){o.on({click:onClick})}function areaStyle(e){return{strokeColor:e.properties.fillColor,fillColor:e.properties.fillColor,fillOpacity:0,weight:1,opacity:1}}function onClick(e){getBounds(blastKey=e.target.feature.properties.Key)}function getBounds(e){for(var o=L.latLngBounds(),r=0;r<geojson.features.length;r++)if(geojson.features[r].properties.Key===e&&"Polygon"==geojson.features[r].geometry.type)for(var t=geojson.features[r].geometry.coordinates[0],n=0;n<t.length;n++)o.extend(L.latLng(t[n][1],t[n][0]));map.fitBounds(o),map.panTo(o.getCenter()),getPattern()}function getBlastPolygons(){$.getJSON("https://www.haulsmart.com/apis/blastpolygons.php",(function(e){console.log(e);var o=getObjectStore("polygons","readwrite"),r=o.clear();try{r=o.add(e)}catch(e){throw e}r.onsuccess=function(e){alert("Insertion in DB successful")},r.onerror=function(){alert("Insertion in DB Failed ",this.error)}})),getholedata()}function getholedata(){$.getJSON("https://www.haulsmart.com/apis/holedata.php?id=so_gw_295_08",(function(e){console.log(e),holemarkers.clearLayers();for(var o=0;o<e.features.length;o++){var r=e.features[o].geometry.coordinates,t=e.features[o].properties.Hole+"<br/>"+e.features[o].properties.HoleType+"<br/>"+(e.features[o].properties.Collar-e.features[o].properties.Toe)+"m",n=L.marker([r[1],r[0]],{icon:holeIcon,id:e.features[o].properties.Hole,type:e.features[o].properties.HoleType,collar:e.features[o].properties.Collar,toe:e.features[o].properties.Toe,dia:e.features[o].properties.Dia,tap:!1}).addTo(map);n.myID=o,n.on("click",(function(e){onHoleClick(e.target.myID)})).bindPopup(t),holemarkers.addLayer(n),addHole(o,e.features[o].properties.Blast,e.features[o].properties.Hole,e.features[o].properties.HoleType,e.features[o].properties.Collar,e.features[o].properties.Toe,e.features[o].properties.Angle,e.features[o].properties.Dipped,r[1],r[0])}}))}function onHoleClick(e){console.log("getHole: "+e),getHole(e)}let holeIcon=getIcon("/images/bh_white.png?n=1",[10,10],[5,5],[0,-15]),dippedIcon=getIcon("/images/bh_red.png?n=1",[10,10],[5,5],[0,-15]);function patternStyle(e){return{i:e.properties.fillColor,fillColor:e.properties.fillColor,fillOpacity:0,weight:1,opacity:1}}setInterval((function(){navigator.geolocation&&(wpid=navigator.geolocation.getCurrentPosition(displayAndWatch,locError,{maximumAge:0,timeout:1e3,enableHighAccuracy:!0}))}),5e3);const DB_NAME="blasts",DB_VERSION=1,DB_STORE_NAME="patterns";var db,holeObj;function openDb(){console.log("openDb ...");var e=indexedDB.open(DB_NAME,1);e.onsuccess=function(e){db=this.result,console.log("openDb DONE"),getPolygons()},e.onerror=function(e){console.error("openDb:",e.target.errorCode)},e.onupgradeneeded=function(e){console.log("openDb.onupgradeneeded");e.currentTarget.result.createObjectStore("polygons",{keyPath:"id",autoIncrement:!0});var o=e.currentTarget.result.createObjectStore("patterns",{keyPath:"id",autoIncrement:!0});o.createIndex("id","id",{unique:!0}),o.createIndex("blast","blast",{unique:!1}),o.createIndex("hole","hole",{unique:!1}),o.createIndex("holetype","holetype",{unique:!1}),o.createIndex("collar","collar",{unique:!1}),o.createIndex("toe","toe",{unique:!1}),o.createIndex("angle","angle",{unique:!1}),o.createIndex("dipped","dipped",{unique:!1}),o.createIndex("lat","lat",{unique:!1}),o.createIndex("lng","lng",{unique:!1})}}function getObjectStore(e,o){return db.transaction(e,o).objectStore(e)}function clearObjectStore(){var e=getObjectStore("patterns","readwrite").clear();e.onsuccess=function(e){console.log("Store cleared")},e.onerror=function(e){console.error("clearObjectStore:",e.target.errorCode),console.log(this.error)}}function addHole(e,o,r,t,n,a,l,s,c,i){console.log("addHole arguments:",arguments);var u,p={id:e,blast:o,hole:r,holetype:t,collar:n,toe:a,angle:l,dipped:s,lat:c,lng:i},d=getObjectStore("patterns","readwrite");try{u=d.add(p)}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}u.onsuccess=function(e){console.log("Insertion in DB successful")},u.onerror=function(){console.error("addHole error",this.error)}}function getPatterns(){console.log("getPatterns");var e,o=getObjectStore("patterns","readwrite");try{e=o.getAll()}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}e.onsuccess=function(o){console.log("Reading DB successful"),console.log(e.result)},e.onerror=function(){console.error("read db error",this.error)}}function getPattern(){console.log("getPattern"),holemarkers.clearLayers();var e,o=getObjectStore("patterns","readwrite");try{e=o.getAll()}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}e.onsuccess=function(o){console.log("Reading DB successful");let r=e.result;for(var t=0;t<r.length;t++){var n=(r[t].collar-r[t].toe).toFixed(1),a=(r[t].hole,r[t].holetype);a="<div><label>Hole: "+r[t].hole+"</label><br/><label>Type: "+r[t].holetype+"</label><br/><label>Depth: "+n+"</label><br/><input id='dippedval' onchange=\"setHole()\" value='"+1*r[t].dipped+"'>";if(1*r[t].dipped>0)var l=dippedIcon;else l=holeIcon;var s=L.marker([r[t].lat,r[t].lng],{icon:l,id:r[t].id,hole:r[t].hole,type:r[t].holetype,collar:r[t].collar,toe:r[t].toe,dipped:r[t].dipped,tap:!1}).addTo(map);s.myID=t,s.on("click",(function(e){onHoleClick(e.target.myID)})).bindPopup(a),holemarkers.addLayer(s)}},e.onerror=function(){console.error("read db error",this.error)}}function getHole(e){var o,r=getObjectStore("patterns","readwrite");try{o=r.get(e)}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}o.onsuccess=function(e){console.log("Reading DB successful"),console.log(o.result),console.log(o.result.hole),holeObj=o.result;var r=1*o.result.collar-1*o.result.toe,t="<div><label>"+o.result.hole+"</label><br/><label>"+o.result.holetype+"</label><br/><label>"+r+"</label><br/><input id='dippedval' onchange=\"setHole()\" value='"+1*o.result.dipped+"'>";$("#root").html(t)},o.onerror=function(){console.error("read db error",this.error)}}function setHole(){console.log(holeObj),console.log(holeObj.id);var e=1*$("#dippedval").val();console.log(e),holeObj.dipped=e,console.log(holeObj);var o,r=getObjectStore("patterns","readwrite");try{o=r.put(holeObj)}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}o.onsuccess=function(e){console.log("Writing to DB successful"),getPattern()},o.onerror=function(){console.error("read db error",this.error)}}openDb()</script><script>!function(e){function t(t){for(var n,l,i=t[0],f=t[1],a=t[2],p=0,s=[];p<i.length;p++)l=i[p],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&s.push(o[l][0]),o[l]=0;for(n in f)Object.prototype.hasOwnProperty.call(f,n)&&(e[n]=f[n]);for(c&&c(t);s.length;)s.shift()();return u.push.apply(u,a||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,i=1;i<r.length;i++){var f=r[i];0!==o[f]&&(n=!1)}n&&(u.splice(t--,1),e=l(l.s=r[0]))}return e}var n={},o={1:0},u=[];function l(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=n,l.d=function(e,t,r){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(l.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(r,n,function(t){return e[t]}.bind(null,n));return r},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var i=this.webpackJsonpclient=this.webpackJsonpclient||[],f=i.push.bind(i);i.push=t,i=i.slice();for(var a=0;a<i.length;a++)t(i[a]);var c=f;r()}([])</script><script src="/static/js/2.709eb99e.chunk.js"></script><script src="/static/js/main.11291cc1.chunk.js"></script></body></html>