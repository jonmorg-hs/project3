<!doctype html><html lang="en"><head><meta name="viewport" content="initial-scale=1,user-scalable=no"/><meta http-equiv="content-type" content="text/html; charset=UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><link rel="shortcut icon" href="/favicon.png" type="image/x-icon"/><link rel="icon" href="/favicon.png"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black"/><meta name="apple-mobile-web-app-title" content="Blasthole_Dipping"/><link rel="apple-touch-icon" href="/logo192.png"/><link rel="manifest" href="/manifest.json"/><title>Blasthole Dipping</title><link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/><link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css"/><link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css"/><script src="https://kit.fontawesome.com/05c6b543c0.js" crossorigin="anonymous"></script><script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script><script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/gh/hosuaby/Leaflet.SmoothMarkerBouncing@v2.0.0/dist/bundle.js" crossorigin="anonymous"></script><script src="https://code.jquery.com/jquery-1.10.2.js"></script><script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script><link href="/static/css/2.3661fc73.chunk.css" rel="stylesheet"><link href="/static/css/main.b739deb5.chunk.css" rel="stylesheet"></head><body><div id="map"></div><div id="root" class="splash"></div><div class="custom-popup" id="popup"></div><script>let currentpos,currentPositionMarker,currentlat,currentlng,wpid=!1,markerscales=[1,2,3,4,5,6,7,8,9,10,14,18,22,25,28,32,35,38,40,42,44,46,48,50],currentposmarker=new L.LayerGroup,holemarkers=new L.LayerGroup,polygons=new L.LayerGroup;window.customOptions={className:"custom-popup"};let holeIcon,redIcon,orangeIcon,greenIcon,myposIcon=L.Icon.extend({iconUrl:"/images/pos.png",iconSize:[10,10],iconAnchor:[5,5]});function getIcon(e,o,n,t){return L.icon({id:"",event_id:"",iconUrl:e,iconSize:o,iconAnchor:n,popupAnchor:t})}function initMap(){map=L.map("map",{minZoom:3,maxZoom:23}).setView([-27.9245562287,122.36137027844],18),map.zoomControl.setPosition("bottomright"),map.on("zoomend",(function(){let e=map.getZoom();markerscales[e];console.log(map.getZoom()),map.getZoom()<21?$(".leaflet-tooltip-own").css("display","none"):$(".leaflet-tooltip-own").css("display","block")})),holeIcon=L.Icon({iconUrl:"/images/bh_white.png?n=1",iconSize:[10,10],iconAnchor:[5,5]}),redIcon=L.Icon.extend({iconUrl:"/images/bh_red.png?n=1",iconSize:[10,10],iconAnchor:[5,5]}),orangeIcon=L.Icon.extend({iconUrl:"/images/bh_orange.png?n=1",iconSize:[10,10],iconAnchor:[5,5]}),greenIcon=L.Icon.extend({iconUrl:"/images/bh_green.png?n=1",iconSize:[10,10],iconAnchor:[5,5]}),openDb()}function displayAndWatch(e){}function locError(e){switch(e.code){case e.PERMISSION_DENIED:break;case e.POSITION_UNAVAILABLE:case e.TIMEOUT:case e.UNKNOWN_ERROR:wpid=navigator.geolocation.getCurrentPosition(displayAndWatch,locError,{maximumAge:0,timeout:1e3,enableHighAccuracy:!0})}}function setCurrentPosition(e){currentlat=e.coords.latitude,currentlng=e.coords.longitude,currentposmarker.clearLayers(),currentPositionMarker=L.marker([e.coords.latitude,e.coords.longitude],{icon:myposIcon}).addTo(map).bindPopup("current position"),currentposmarker.addLayer(currentPositionMarker)}map,$(document).ready((function(){initMap(),navigator.geolocation?wpid=navigator.geolocation.getCurrentPosition(displayAndWatch,locError,{maximumAge:0,timeout:1e3,enableHighAccuracy:!0}):alert("Your browser does not support the Geolocation API")}));var blastKey,geojson=[];function getblastdata1(){$.getJSON("https://www.haulsmart.com/apis/patterndata.php",(function(e){geojson=e,L.geoJson(e,{style:areaStyle,onEachFeature:onEachFeature}).addTo(map)}))}function getPolygons(){console.log("getPatterns");var e,o=window.db.transaction("polygons","readwrite").objectStore("polygons");try{e=o.getAll()}catch(e){console.log(e)}e.onsuccess=function(o){console.log("Reading DB successful"),console.log(e.result[0]),delete e.result[0].id,geojson=e.result,console.log(e.result[0]),L.geoJson(e.result[0],{style:areaStyle,onEachFeature:onEachFeature}).addTo(map)},e.onerror=function(){console.error("read db error",this.error)}}function onEachFeature(e,o){o.on({click:onClick})}function areaStyle(e){return{strokeColor:e.properties.fillColor,fillColor:e.properties.fillColor,fillOpacity:0,weight:1,opacity:1}}function onClick(e){getBounds(blastKey=e.target.feature.properties.Key)}function getBounds(e){for(var o=L.latLngBounds(),n=0;n<geojson.features.length;n++)if(geojson.features[n].properties.Key===e&&"Polygon"==geojson.features[n].geometry.type)for(var t=geojson.features[n].geometry.coordinates[0],r=0;r<t.length;r++)o.extend(L.latLng(t[r][1],t[r][0]));map.fitBounds(o),map.panTo(o.getCenter()),getPattern()}function getholedata(){$.getJSON("https://www.haulsmart.com/apis/holedata.php?id=so_gw_295_08",(function(e){console.log(e),holemarkers.clearLayers();for(var o=0;o<e.features.length;o++){var n=e.features[o].geometry.coordinates,t=e.features[o].properties.Hole+"<br/>"+e.features[o].properties.HoleType+"<br/>"+(e.features[o].properties.Collar-e.features[o].properties.Toe)+"m",r=L.marker([n[1],n[0]],{icon:holeIcon,id:e.features[o].properties.Hole,type:e.features[o].properties.HoleType,collar:e.features[o].properties.Collar,toe:e.features[o].properties.Toe,dia:e.features[o].properties.Dia,tap:!1}).addTo(map);r.myID=o,r.on("click",(function(e){onHoleClick(e.target.myID)})).bindPopup(t),holemarkers.addLayer(r),addHole(o,e.features[o].properties.Blast,e.features[o].properties.Hole,e.features[o].properties.HoleType,e.features[o].properties.Collar,e.features[o].properties.Toe,e.features[o].properties.Angle,e.features[o].properties.Dipped,n[1],n[0])}}))}function onHoleClick(e){console.log("getHole: "+e),getHole(e)}function patternStyle(e){return{i:e.properties.fillColor,fillColor:e.properties.fillColor,fillOpacity:0,weight:1,opacity:1}}function openDb(){console.log("openDb ...");var e=indexedDB.open(window.DB_NAME,window.DB_VERSION);e.onsuccess=function(e){window.db=this.result,console.log("openDb DONE"),getPolygons(),getPattern()},e.onerror=function(e){console.error("openDb:",e.target.errorCode)},e.onupgradeneeded=function(e){console.log("openDb.onupgradeneeded");e.currentTarget.result.createObjectStore("polygons",{keyPath:"id",autoIncrement:!0});var o=e.currentTarget.result.createObjectStore(window.DB_STORE_NAME,{keyPath:"id",autoIncrement:!0});o.createIndex("id","id",{unique:!0}),o.createIndex("blast","blast",{unique:!1}),o.createIndex("hole","hole",{unique:!1}),o.createIndex("holetype","holetype",{unique:!1}),o.createIndex("collar","collar",{unique:!1}),o.createIndex("toe","toe",{unique:!1}),o.createIndex("angle","angle",{unique:!1}),o.createIndex("dipped","dipped",{unique:!1}),o.createIndex("lat","lat",{unique:!1}),o.createIndex("lng","lng",{unique:!1})}}function addHole(e,o,n,t,r,a,l,i,c,s){console.log("addHole arguments:",arguments);var u,p={id:e,blast:o,hole:n,holetype:t,collar:r,toe:a,angle:l,dipped:i,lat:c,lng:s},d=window.db.transaction(window.DB_STORE_NAME,"readwrite").objectStore(window.DB_STORE_NAME);try{u=d.add(p)}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}u.onsuccess=function(e){console.log("Insertion in DB successful")},u.onerror=function(){console.error("addHole error",this.error)}}let patterndata;function getPatterns(){console.log("getPatterns");var e,o=window.db.transaction(window.DB_STORE_NAME,"readwrite").objectStore(window.DB_STORE_NAME);try{e=o.getAll()}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}e.onsuccess=function(o){console.log("Reading DB successful"),console.log(e.result)},e.onerror=function(){console.error("read db error",this.error)}}function getPattern(){console.log("getPattern"),holemarkers.clearLayers();var e,o=window.db.transaction(window.DB_STORE_NAME,"readwrite").objectStore(window.DB_STORE_NAME);try{e=o.getAll()}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}e.onsuccess=function(o){console.log("Reading DB successful");let n=e.result;patterndata=e.result;for(var t=L.latLngBounds(),r=0;r<n.length;r++){var a=(n[r].collar-n[r].toe).toFixed(1),l=(n[r].dipped,n[r].hole,n[r].holetype);l="<div><label>Hole: "+n[r].hole+"</label><br/><label>Type: "+n[r].holetype+"</label><br/><label>Depth: "+a+"</label><br/><label>Dipped:</label><input id='dippedval' style='margin-left:10px;width:100px' onchange=\"setHole()\" value='"+1*n[r].dipped+"'><br/><br/><input type='button' value='OK' style='width:200px' onclick=\"setHole()\"/><br/><br/><input type='button' value='Cancel' style='width:200px' onclick=\"map.closePopup()\"/>";t.extend(L.latLng(n[r].lat,n[r].lng));var i=L.marker([n[r].lat,n[r].lng],{icon:holeIcon,id:n[r].id,hole:n[r].hole,type:n[r].holetype,collar:n[r].collar,toe:n[r].toe,dipped:n[r].dipped,tap:!1}).addTo(map);i.myID=r,i.on("click",(function(e){onHoleClick(e.target.myID)})).bindTooltip(n[r].hole,{permanent:!0,direction:"right",offset:[10,0],className:"leaflet-tooltip-own"}).bindPopup(l,window.customOptions),holemarkers.addLayer(i)}holemarkers.eachLayer((function(e){var o=1*e.options.Collar-1*e.options.Toe,n=1*e.options.dipped-o;1*e.options.dipped==0||(n>-.3&&n<.3?e.setIcon(new greenIcon):n>-.5&&n<.5?e.setIcon(new orangeIcon):e.setIcon(new redIcon))})),map.fitBounds(t),map.panTo(t.getCenter())},e.onerror=function(){console.error("read db error",this.error)}}var holeObj;function getHole(e){var o,n=window.db.transaction(window.DB_STORE_NAME,"readwrite").objectStore(window.DB_STORE_NAME);try{o=n.get(e)}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}o.onsuccess=function(e){console.log("Reading DB successful"),console.log(o.result),console.log(o.result.hole),holeObj=o.result;var n=1*o.result.collar-1*o.result.toe;o.result.hole,o.result.holetype,o.result.dipped},o.onerror=function(){console.error("read db error",this.error)}}function setHole(){console.log(holeObj),console.log(holeObj.id);var e=1*$("#dippedval").val();console.log(e),holeObj.dipped=e;var o=1*holeObj.collar-1*holeObj.toe,n=e-o;console.log(holeObj);var t,r=window.db.transaction(window.DB_STORE_NAME,"readwrite").objectStore(window.DB_STORE_NAME);try{t=r.put(holeObj)}catch(e){throw"DataCloneError"==e.name&&console.log("This engine doesn't know how to clone a Blob, use Firefox"),e}t.onsuccess=function(o){console.log("Writing to DB successful"),holemarkers.eachLayer((function(o){1*o.options.hole==1*holeObj.id&&(console.log("hole found"),0===e||(n>-.3&&n<.3?o.setIcon(new greenIcon):n>-.5&&n<.5?o.setIcon(new orangeIcon):o.setIcon(new redIcon)))})),uploadHole(holeObj)},t.onerror=function(){console.error("read db error",this.error)}}function uploadHole(e){console.log(JSON.stringify(e)),!0===navigator.onLine?(console.log("online"),$.ajax({url:"https://www.haulsmart.com/apis/setHole.php",type:"POST",data:{json:JSON.stringify(e)},timeout:1e4,error:function(){},dataType:"text",success:function(e){map.closePopup()}})):console.log("offline")}function uploadPattern(){!0===navigator.onLine?(console.log("online"),$.ajax({url:"https://www.haulsmart.com/apis/setPattern.php",type:"POST",crossDomain:!0,data:{json:JSON.stringify(patterdata)},timeout:1e4,error:function(){},dataType:"text",success:function(e){alert(e)}})):console.log("offline")}setInterval((function(){navigator.geolocation&&(wpid=navigator.geolocation.getCurrentPosition(displayAndWatch,locError,{maximumAge:0,timeout:1e3,enableHighAccuracy:!0}))}),5e3),window.db,window.DB_NAME="blasts",window.DB_VERSION=1,window.DB_STORE_NAME="patterns","serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/serviceworker.js").then((function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}),(function(e){console.log("ServiceWorker registration failed: ",e)}))}))</script><script>!function(e){function t(t){for(var n,l,i=t[0],f=t[1],a=t[2],p=0,s=[];p<i.length;p++)l=i[p],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&s.push(o[l][0]),o[l]=0;for(n in f)Object.prototype.hasOwnProperty.call(f,n)&&(e[n]=f[n]);for(c&&c(t);s.length;)s.shift()();return u.push.apply(u,a||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,i=1;i<r.length;i++){var f=r[i];0!==o[f]&&(n=!1)}n&&(u.splice(t--,1),e=l(l.s=r[0]))}return e}var n={},o={1:0},u=[];function l(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=n,l.d=function(e,t,r){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(l.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(r,n,function(t){return e[t]}.bind(null,n));return r},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/";var i=this.webpackJsonpclient=this.webpackJsonpclient||[],f=i.push.bind(i);i.push=t,i=i.slice();for(var a=0;a<i.length;a++)t(i[a]);var c=f;r()}([])</script><script src="/static/js/2.d200d208.chunk.js"></script><script src="/static/js/main.ab954067.chunk.js"></script></body></html>